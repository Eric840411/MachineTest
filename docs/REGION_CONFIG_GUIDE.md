# 區域比對配置指南

## 概述

區域比對允許您只比對圖片的特定區域，而不是整個頁面。這對於：
- 忽略可能變化的 UI 元素（如按鈕、文字）
- 只比對穩定的遊戲區域
- 提高比對準確度

## 座標系統

- **原點 (0, 0)**：在圖片左上角
- **X 軸**：向右遞增（寬度方向）
- **Y 軸**：向下遞增（高度方向）
- **單位**：像素

```
(0, 0) ──────────────> X (寬度)
  │
  │
  │
  │
  ▼
  Y (高度)
```

## 瀏覽器視窗尺寸

根據配置，瀏覽器視窗大小為：
- **寬度**: 500 像素
- **高度**: 859 像素

## 區域配置格式

在 `test_flows.json` 中配置：

```json
{
  "image_comparison": {
    "enabled": true,
    "similarity_threshold": 0.8,
    "selector": null,
    "region": {
      "x": 0,        // 起始 X 座標（從左邊開始）
      "y": 0,        // 起始 Y 座標（從頂部開始）
      "width": 500,  // 區域寬度
      "height": 400  // 區域高度
    },
    "images": []
  }
}
```

## 常用區域配置範例

### 1. 只比對上半部分（遊戲區域）

適合比對遊戲的主要顯示區域，避開底部控制按鈕：

```json
{
  "region": {
    "x": 0,
    "y": 0,
    "width": 500,
    "height": 400
  }
}
```

### 2. 只比對中間部分（轉輪區域）

適合比對遊戲轉輪區域：

```json
{
  "region": {
    "x": 0,
    "y": 150,
    "width": 500,
    "height": 300
  }
}
```

### 3. 只比對下半部分（控制按鈕區域）

適合比對控制按鈕區域：

```json
{
  "region": {
    "x": 0,
    "y": 500,
    "width": 500,
    "height": 359
  }
}
```

### 4. 只比對中心區域（避開邊緣）

適合比對中心穩定的遊戲區域，避開邊緣可能變化的元素：

```json
{
  "region": {
    "x": 50,
    "y": 50,
    "width": 400,
    "height": 759
  }
}
```

### 5. 只比對左半部分

```json
{
  "region": {
    "x": 0,
    "y": 0,
    "width": 250,
    "height": 859
  }
}
```

### 6. 只比對右半部分

```json
{
  "region": {
    "x": 250,
    "y": 0,
    "width": 250,
    "height": 859
  }
}
```

## 根據 COINCOMBO 遊戲界面設置

根據您的遊戲界面，建議的區域配置：

### Entry 階段 - 比對遊戲主要區域

```json
{
  "name": "進入機器",
  "config": {
    "image_comparison": {
      "enabled": true,
      "similarity_threshold": 0.7,
      "selector": null,
      "region": {
        "x": 0,
        "y": 0,
        "width": 500,
        "height": 600
      }
    }
  }
}
```

這個配置會比對：
- 頂部的 Jackpot 顯示（FORTUNE, GRAND, MAJOR 等）
- 中間的遊戲轉輪區域
- 避開底部的控制按鈕（可能會有變化）

### 只比對遊戲轉輪區域

如果只想比對轉輪區域：

```json
{
  "region": {
    "x": 0,
    "y": 200,
    "width": 500,
    "height": 350
  }
}
```

## 如何確定區域座標

### 方法 1: 使用工具

運行區域座標獲取工具：

```bash
python get_region_coords.py <您的遊戲URL>
```

這個工具會：
1. 打開瀏覽器並截圖
2. 顯示視窗和截圖尺寸
3. 提供常用區域配置範例

### 方法 2: 手動計算

1. **打開遊戲頁面**
2. **使用瀏覽器開發者工具**：
   - 按 F12 打開開發者工具
   - 使用選擇工具選擇要比對的區域
   - 查看元素的 `offsetLeft`, `offsetTop`, `offsetWidth`, `offsetHeight`

3. **使用圖片編輯軟體**：
   - 打開截圖（entry_1.png）
   - 使用選擇工具選擇區域
   - 查看選擇區域的座標和尺寸

### 方法 3: 逐步調整

1. 先設置一個較大的區域
2. 運行測試，查看比對結果
3. 根據結果逐步縮小區域，直到找到最穩定的區域

## 最佳實踐

1. **選擇穩定的區域**：
   - 避開可能變化的 UI 元素（按鈕、文字、動畫）
   - 選擇遊戲的主要顯示區域

2. **適當的區域大小**：
   - 太小：可能無法有效比對
   - 太大：可能包含太多變化的元素
   - 建議：覆蓋遊戲的主要區域，約 60-80% 的畫面

3. **調整相似度閾值**：
   - 使用區域比對時，可以適當降低閾值（例如從 0.8 降到 0.7）
   - 因為只比對部分區域，相似度可能會有所不同

4. **測試和調整**：
   - 設置區域後，運行測試
   - 根據比對結果調整區域座標
   - 確保參考圖片也是在相同區域截取的

## 範例：COINCOMBO Entry 配置

根據您的遊戲界面，建議的配置：

```json
{
  "name": "進入機器",
  "config": {
    "wait_for_selector": ".game-container, canvas, video",
    "check_loading": true,
    "image_comparison": {
      "enabled": true,
      "similarity_threshold": 0.7,
      "selector": null,
      "region": {
        "x": 0,
        "y": 0,
        "width": 500,
        "height": 600
      },
      "images": []
    }
  }
}
```

這個配置會：
- 比對上半部分（0-600 像素高度）
- 包含 Jackpot 顯示和遊戲轉輪區域
- 避開底部的控制按鈕（可能會有變化）
- 使用 70% 的相似度閾值（因為只比對部分區域）





