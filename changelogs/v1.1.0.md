# v1.1.0 - 新增音頻品質檢測

**日期**: 2026-02-08

## 新增功能

### 音頻品質檢測模組 (`qa/audio_detector.py`)
- 透過 Web Audio API 注入 JavaScript 監控遊戲音頻
- 支援以下檢測項目：
  - **靜音檢測**：是否有聲音輸出
  - **音量檢測**：音量過小 / 過大判斷（dB）
  - **爆音/失真**：Clipping ratio 超標警告
  - **聲道檢測**：單聲道 / 立體聲（透過左右聲道相關性）
  - **底噪分析**：最低音量區間分析
- 可配置的閾值：`_default/audio_config.json` 和每個 machine_profile 的 `audio_config.json`
- 支援配置合併（deep merge）：預設 → _default → 遊戲專屬 → flow config

### 音頻測試工具 (`scripts/test_audio.py`)
- 互動式音頻測試，讓使用者即時看到分貝、聲道、爆音狀態
- 支援模式：
  - `Enter` → 採樣 5 秒並分析（顯示完整報告）
  - `l` → 即時音量監控（持續顯示 dB 條形圖）
  - `q` → 結束
- 可直接指定 URL 或從 `game_config.json` 讀取
- 視覺化 dB 條形圖，標註 SILENT / LOW / OK / LOUD / CLIP

### 預設音頻配置 (`machine_profiles/_default/audio_config.json`)
- 音量範圍：-40 dB ~ -3 dB
- 靜音閾值：-60 dB
- 爆音閾值：clipping ratio > 0.01
- 立體聲要求：聲道相關性 < 0.95

## 修改的檔案

| 檔案 | 修改內容 |
|------|---------|
| `qa/audio_detector.py` | 新增 - 音頻檢測核心模組 |
| `qa/__init__.py` | 新增 AudioDetector 匯出 |
| `scripts/test_audio.py` | 新增 - 互動式音頻測試工具 |
| `machine_profiles/_default/audio_config.json` | 新增 - 預設音頻配置 |
| `game/game_runner.py` | 新增音頻監控注入、音頻測試流程支援 |
| `version.py` | 版本號更新至 v1.1.0 |

## 如何啟用

### 1. 使用測試工具（獨立測試分貝）
```bash
python scripts/test_audio.py
python scripts/test_audio.py "https://your-game-url"
```

### 2. 在測試流程中啟用
在 `test_flows.json` 中新增音頻檢測流程：
```json
{
  "name": "音頻檢測",
  "description": "檢測音頻品質：音量、爆音、聲道",
  "enabled": true
}
```

### 3. 自訂閾值
在 machine_profile 資料夾內建立 `audio_config.json`：
```json
{
  "volume": { "min_db": -35, "max_db": -5 },
  "stereo": { "require_stereo": false }
}
```

## 回滾方式
1. 刪除 `qa/audio_detector.py`
2. 從 `qa/__init__.py` 移除 `AudioDetector` 匯出
3. 從 `game/game_runner.py` 移除 `AudioDetector` 和 `load_audio_config` 相關 import 和程式碼
4. 刪除 `scripts/test_audio.py`
5. 刪除 `machine_profiles/_default/audio_config.json`
6. 將 `version.py` 回復至 v1.0.1

